<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Android-Android性能优化 | 王璐的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="其实关于性能优化这个我也只是学到个皮毛，我是按照书上说的加上自己理解的来写，如果有不对的地方，请指正，我也是个菜鸟。谢谢  Android性能的优化主要分为两点  布局优化 内存优化  布局优化首先来看一下布局优化，系统在渲染UI的时候会消耗大量的资源，所以，对布局的优化就显得尤为重要 避免Overdraw也就是避免过度的绘制，过度的绘制会浪费更多的资源，举个例子，Android系统会默认绘制A">
<meta property="og:type" content="article">
<meta property="og:title" content="Android-Android性能优化">
<meta property="og:url" content="http:/2018/04/13/Android/Android-Android性能优化/index.html">
<meta property="og:site_name" content="王璐的博客">
<meta property="og:description" content="其实关于性能优化这个我也只是学到个皮毛，我是按照书上说的加上自己理解的来写，如果有不对的地方，请指正，我也是个菜鸟。谢谢  Android性能的优化主要分为两点  布局优化 内存优化  布局优化首先来看一下布局优化，系统在渲染UI的时候会消耗大量的资源，所以，对布局的优化就显得尤为重要 避免Overdraw也就是避免过度的绘制，过度的绘制会浪费更多的资源，举个例子，Android系统会默认绘制A">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1822424-0cf8e3b06aa8b4ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2018-04-13T00:53:11.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android-Android性能优化">
<meta name="twitter:description" content="其实关于性能优化这个我也只是学到个皮毛，我是按照书上说的加上自己理解的来写，如果有不对的地方，请指正，我也是个菜鸟。谢谢  Android性能的优化主要分为两点  布局优化 内存优化  布局优化首先来看一下布局优化，系统在渲染UI的时候会消耗大量的资源，所以，对布局的优化就显得尤为重要 避免Overdraw也就是避免过度的绘制，过度的绘制会浪费更多的资源，举个例子，Android系统会默认绘制A">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1822424-0cf8e3b06aa8b4ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
  
    <link rel="alternate" href="/atom.xml" title="王璐的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">王璐的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http:"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Android/Android-Android性能优化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/13/Android/Android-Android性能优化/" class="article-date">
  <time datetime="2018-04-13T00:39:31.000Z" itemprop="datePublished">2018-04-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android-Android性能优化
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>其实关于性能优化这个我也只是学到个皮毛，我是按照书上说的加上自己理解的来写，<strong>如果有不对的地方，请指正，我也是个菜鸟。谢谢</strong></p>
</blockquote>
<p>Android性能的优化主要分为两点</p>
<ol>
<li>布局优化</li>
<li>内存优化</li>
</ol>
<h2 id="布局优化"><a href="#布局优化" class="headerlink" title="布局优化"></a>布局优化</h2><p>首先来看一下布局优化，系统在渲染UI的时候会消耗大量的资源，所以，对布局的优化就显得尤为重要</p>
<h4 id="避免Overdraw"><a href="#避免Overdraw" class="headerlink" title="避免Overdraw"></a>避免Overdraw</h4><p>也就是避免过度的绘制，过度的绘制会浪费更多的资源，<strong>举个例子，Android系统会默认绘制Activity的背景，这时候我们再设置一个背景，这样默认的背景就属于过度绘制了，</strong>在『开发者工具』中有一个『调试GPU过度绘制』的选项，我们打开就可以通过颜色来判断过度绘制的次数，如图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1822424-0cf8e3b06aa8b4ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>所以说我们尽可能的<strong>增大蓝色区域，减少红色区域</strong></p>
<h4 id="优化布局层级"><a href="#优化布局层级" class="headerlink" title="优化布局层级"></a>优化布局层级</h4><p>在Android系统中，系统对View进行测量、布局、绘制的时候，都是通过对View树的遍历来进行的，所以说<strong>一个布局的层级太多，就会严重影响测量、布局、绘制的速度，所以要降低View树的高度，Google在文档中建议布局的层级不超过10层，所以还要避免嵌套没有用的布局</strong></p>
<h4 id="使用include标签"><a href="#使用include标签" class="headerlink" title="使用include标签"></a>使用include标签</h4><p>相信大家都会在项目的时候遇到toolbar，或者一个UI在多个界面使用的问题，遇到这种问题的时候我们一般都会用include（毕竟郭神『第一行代码』教的好），这样就减少了代码冗余，而且还利于后期更改</p>
<h4 id="使用ViewStub实现View的延时加载"><a href="#使用ViewStub实现View的延时加载" class="headerlink" title="使用ViewStub实现View的延时加载"></a>使用ViewStub实现View的延时加载</h4><p>ViewStub标签和View.GONE的方式差不多，但是ViewStub只会在显示的时候去渲染，而GONE在初始化的时候就已经渲染完毕了，所以相比来说ViewStub的效率更高。下面来通过代码使用一下ViewStub</p>
<p>首先我们定义一个布局文件</p>
<pre><code>&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:orientation=&quot;vertical&quot; android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;&gt;

    &lt;TextView
        android:id=&quot;@+id/tv&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot; /&gt;

&lt;/LinearLayout&gt;
</code></pre><p>这里面只放了一个TextView，然后我们在自己的布局中通过ViewStub来引用他</p>
<pre><code>&lt;Button
   android:id=&quot;@+id/btn&quot;
   android:layout_width=&quot;wrap_content&quot;
   android:layout_height=&quot;wrap_content&quot; /&gt;

&lt;ViewStub
   android:id=&quot;@+id/vs&quot;
   android:layout_width=&quot;wrap_content&quot;
   android:layout_height=&quot;wrap_content&quot;
   android:layout=&quot;@layout/view_stub&quot;/&gt;
</code></pre><p>这里的逻辑是点击按钮然后出现ViewStub引用的布局（也就是我们上面写的那个布局文件）</p>
<pre><code>findViewById(R.id.btn).setOnClickListener(new View.OnClickListener() {
    @Override
    public void onClick(View view) {
        ViewStub vs = (ViewStub) findViewById(R.id.vs);
        View vsView = vs.inflate();
        TextView tv = (TextView) vsView.findViewById(R.id.tv);
        tv.setText(&quot;hahaha&quot;);

    }
});
</code></pre><p>这里想要把ViewStub引用的布局显示出来有两种办法，一种是ViewStub.setVisibility();另一种就是ViewStub.inflate();这两种方法的区别就是inflate()能返回引用的布局，然后可以通过这个布局来找到里面的子View来进行操作</p>
<p>运行程序点击按钮，就可以看到TextView已经显示出来了，并且已经赋值『hahaha』</p>
<h4 id="Hierarchy-Viewer"><a href="#Hierarchy-Viewer" class="headerlink" title="Hierarchy Viewer"></a>Hierarchy Viewer</h4><p>这个工具可以显示我们的布局，但是只可以在模拟器和工厂的Demo机上用，不过Google的大神提供了一个开源的项目ViewServer，有兴趣的可以看一下，地址：<a href="https://github.com/romainguy/ViewServer" target="_blank" rel="noopener">ViewServer</a></p>
<p>这个就不过多阐述了，有兴趣的可以自行查看一下相关的资料</p>
<h2 id="内存优化"><a href="#内存优化" class="headerlink" title="内存优化"></a>内存优化</h2><p>我们都知道，最近Android的厂商就是在拼配置，其中我们最关注的就是内存几个G，但是Android手机有的内存很大，但是很卡，这是因为有的手机软件在手机内存低的情况下不能被杀死，也就是我们说的『防杀』</p>
<p>我们知道内存一般分为这几个部分</p>
<ul>
<li>寄存器</li>
<li>栈</li>
<li>堆</li>
<li>静态存储区</li>
<li>常量池</li>
</ul>
<p>其中寄存器运算速度最快，但是我们在程序里无法控制</p>
<p>栈里存放基本数据类型</p>
<p>堆里存放对象和数组，在堆中的一般由Java的GC还管理</p>
<p>静态存储区在固定的位置存放应用程序中运行时一直存在的数据，Java专门划分了一个区域来管理静态变量</p>
<p>常量池就是该类型所使用到的常量的集合</p>
<h4 id="Bitmap的优化"><a href="#Bitmap的优化" class="headerlink" title="Bitmap的优化"></a>Bitmap的优化</h4><p>我们都知道在Android中是造成OOM的最大威胁，因为它占用的内存特别多，所以我们应该：</p>
<ul>
<li>使用适当分辨率大小的图片<ul>
<li>由于Android在做适配的时候会对不同分辨率的文件夹下的图片来进行缩放适配，如果图片的分辨率与资源分辨率不匹配的话就会导致消耗更多的资源</li>
</ul>
</li>
<li>使用缓存<ul>
<li>一般有内存缓存和硬盘缓存</li>
</ul>
</li>
</ul>
<h4 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h4><ul>
<li>对常量使用static</li>
<li>使用静态方法，静态方法比普通方法提高15%左右的访问速度</li>
<li>减少没有必要的成员变量，如果能定义成局部变量就最好定义成局部变量</li>
<li>减少不必要的对象</li>
<li>少用枚举、迭代器</li>
<li>对Cursor、Receiver、File等对象，要注意回收和取消注册</li>
<li>使用SurfaceView来代替View进行大量并且频繁的绘图操作</li>
<li>尽量使用视图缓存，不是每次都执行inflate()来解析视图</li>
<li>避免使用反射</li>
<li>使用RenderScript、OpenGL来进行非常复杂的绘图操作</li>
</ul>
<p>以上就是对Android性能优化的一些点，如果你用AndroidStudio的话，AndroidStudio提供了一个内存监视的工具，还是很好用的，如果你没用AndroidStudio，那么我建议你使用AndroidStudio~</p>
<hr>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>爱生活，爱小丽，爱Android</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http:/2018/04/13/Android/Android-Android性能优化/" data-id="cjfx8xuf70001qqfyivmn4r58" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/04/13/Android/Android-属性动画/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Android-属性动画
        
      </div>
    </a>
  
  
    <a href="/2018/04/13/Android/Android-自定义ViewGroup/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">自定义ViewGroup</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/04/13/Python/Python-学装饰器之前，有几个点要理解/">Python-学装饰器之前，有几个点要理解</a>
          </li>
        
          <li>
            <a href="/2018/04/13/Python/Python-记学习对象可变性/">Python-记学习对象可变性</a>
          </li>
        
          <li>
            <a href="/2018/04/13/Android/Android-自定义banner实现/">Android-自定义banner实现</a>
          </li>
        
          <li>
            <a href="/2018/04/13/Android/Android-自定义View/">Android - 自定义View</a>
          </li>
        
          <li>
            <a href="/2018/04/13/Android/Android-各种情况下的『自动加载更多』/">Android-各种情况下的『自动加载更多』</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 王璐<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>